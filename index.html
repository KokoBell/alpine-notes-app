<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="This is a Grocery List web-app built with AlpineJS and Bootstrap. It also keeps track of the total cost of your groceries.">
    <title>Notes App</title>

    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="manifest" href="../manifest.json">
</head>

<body>

    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("sw.js")
        }
    </script>



    <div x-data="{
        name: 'Groceries',
        subtitle: 'Items to get',
        note: '',
        price: '0',
        count: localStorage.getItem('list') === null ? 0 : JSON.parse(localStorage.getItem('list')).array_list.length,
        totalCost: localStorage.getItem('list') === null ? 0 : JSON.parse(localStorage.getItem('list')).array_list.map((item) => {
        return [parseInt(item.price)]
        }).reduce( (total, next) => {
            return total + next
        })
        
        /*() => {
            let t = 0
            let l = JSON.parse(localStorage.getItem('list')).array_list
            for(let i = 0; i < l.length; i++) {
                t+=parseInt(l[i].price)
            }
            return t
        }*/,
        list: localStorage.getItem('list') === null ? {
            'array_list': []
        } : JSON.parse(localStorage.getItem('list')),
        add() {
            var regex=/^[a-zA-Z]+$/;
            if (this.price.match(regex))
            {
                alert('Price must be a number');
                return
            }

            if(this.note === '') {

                alert('Item field should not be empty')
                return
            }
            
            this.list.array_list.push({label: this.note, price: parseInt(this.price)})
            localStorage.setItem('list', JSON.stringify(this.list))
            this.totalCost = this.totalCost + parseInt(this.price)
            this.count += 1
            this.note = ''
            this.price = '0'
        },
        remove(item) {
            var p = parseInt(this.list.array_list[this.list.array_list.indexOf(item)].price)
            this.list.array_list.splice(this.list.array_list.indexOf(item), 1)
            localStorage.setItem('list', JSON.stringify(this.list))
            this.totalCost = this.totalCost < 0 ? 0 : this.totalCost - parseInt(this.price)
            this.count = this.count < 0 ? 0 : this.count - 1
        }
    }" class="container mt-4">

        <h1 x-text="name"></h1>

        <div>
            <p>
                Total: <span x-text="totalCost"></span>
            </p>

            <p>
                Number of Items: <span x-text="count"></span>
            </p>
        </div>

        <label for="note">Item</label>
        <input class="form-control mt-2 mb-3" x-model="note" type="text" id="note">
        <label for="price">Price</label>
        <input class="form-control mt-2 mb-3" x-model="price" type="text" id="price">

        <button x-on:click="add" class="btn btn-primary mb-5">
            Add
        </button>

        <h2 x-text="subtitle" class="mt-5 mb-5"></h2>

        <ul class="list-group">
            <template x-for="item in list.array_list">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span x-text="item.label"></span>
                    <span x-text="item.price"></span>
                    <button @click="remove(item)" type="button" class="btn btn-sm btn-danger btn-small">&times;</button>
                </li>
            </template>
        </ul>
    </div>
</body>

</html>